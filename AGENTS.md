# Agent Instructions (Triangulum - Daily3Albums)

## Mission
When asked to run a "doctor/health-check", you must produce a reproducible repo health report for this project:
- Human report: REPORT.md (repo root)
- Machine receipt: doctor/REPORT.json
- Screenshots (3): doctor/screenshots/today.png, doctor/screenshots/archive.png, doctor/screenshots/detail.png

## Hard gates (must PASS)
1) External services minimal probe:
   - Last.fm (requires LASTFM_API_KEY)
   - MusicBrainz (requires MB_USER_AGENT)
   These are hard requirements. If either is missing or probe fails, overall status = FAIL.

2) Build pipeline must complete:
   - Python pipeline: `daily3albums build --tag electronic --verbose`
   - UI build (if ui/ exists): `npm --prefix ui run build`
   Output must exist under `_build/public/`.

3) Rate limits + caching:
   - All external calls must respect existing rate limit + cache mechanisms in the repo.
   - Do NOT add bypasses. Prefer cache hits where possible.

## Soft coverage (may WARN, must not FAIL)
- Discogs / ListenBrainz / SMTP probes are best-effort.
- If not configured or probe fails: mark coverage=PARTIAL and add risk notes.

## Environment artifacts (must not be committed)
- Treat `.env` as an environment artifact (generated by the Codex environment). Ensure it is gitignored.
- Treat REPORT.md, doctor/REPORT.json, doctor/screenshots/* as run artifacts (gitignore recommended).

## Expected outputs (always)
- REPORT.md: executive summary + PASS/WARN/FAIL checklist + exact commands run + key logs/paths +
  "Algorithm & Rules" section explaining how Headliner/Lineage/DeepCut are computed in THIS repo implementation.
- doctor/REPORT.json: structured checklist results + environment summary + external services coverage + artifact paths.
- 3 screenshots:
  1) Today page (or homepage)
  2) Archive list page
  3) A stable detail page (prefer: first archive item detail); if missing, capture the app's error/empty state.

## Validation commands (run in doctor)
- `daily3albums build --tag electronic --verbose`
- `npm --prefix ui run build` (if ui exists)

## Notes
- You are running in Codex Web (cloud env). Network is allowed, but must be minimal and rate-limited.
- Prefer small, reversible changes. If you must add doctor scripts, keep them isolated under doctor/.
